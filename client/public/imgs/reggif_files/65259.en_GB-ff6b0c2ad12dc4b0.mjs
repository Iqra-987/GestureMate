(self.modernJsonp=self.modernJsonp||[]).push([["65259"],{461093:function(e,t,r){r.d(t,{hw:()=>o,r9:()=>n,sh:()=>s});var i=r(147227),a=r(657043);let n=(e,t)=>t?"100%":e?i.Qi:i.$A,s=e=>e?"100%":"95%",o=e=>({message:(0,a.Z)(e,"message"),api_error_code:(0,a.Z)(e,"api_error_code"),error_code:(0,a.Z)(e,"error_code"),code:(0,a.Z)(e,"code"),httpStatus:(0,a.Z)(e,"httpStatus")})},147227:function(e,t,r){r.d(t,{$A:()=>s,J7:()=>i,MB:()=>u,NJ:()=>_,PF:()=>v,Qi:()=>o,_f:()=>n,a2:()=>f,aN:()=>a,aS:()=>m,br:()=>P,f$:()=>x,jI:()=>l,n7:()=>c,qm:()=>h,rd:()=>g,ts:()=>d,vB:()=>w,vF:()=>b,x1:()=>p,yg:()=>y});let i="#f0f0eb",a="#c957bd",n="100",s="469px",o="900px",c=600,l={__style:{backgroundColor:"#E9E4FF"}},u="520px",d="180px",p=2,h="@",_=2,m=e=>({"Thinking about the question":e.bt("Thinking about the question", "Thinking about the question", "concierge.components.chat.thinking.steps.text", undefined, true),Finish:e.bt("Finish", "Finish", "concierge.components.chat.finish.steps.text", undefined, true),"Generating the response":e.bt("Generating the response", "Generating the response", "concierge.components.chat.generating.steps.text", undefined, true),"Classifying the question":e.bt("Classifying the question", "Classifying the question", "concierge.components.chat.classifying.steps.text", undefined, true),"Fetching the data tables":e.bt("Fetching the data tables", "Fetching the data tables", "concierge.components.chat.fetching.steps.text", undefined, true),"Generating the query":e.bt("Generating the query", "Generating the query", "concierge.components.chat.query.steps.text", undefined, true),"Picking up the best query":e.bt("Picking up the best query", "Picking up the best query", "concierge.components.chat.best.query.steps.text", undefined, true),"Validating the query":e.bt("Validating the query", "Validating the query", "concierge.components.chat.validating.steps.text", undefined, true),"Correcting the query":e.bt("Correcting the query", "Correcting the query", "concierge.components.chat.correcting.steps.text", undefined, true),"Using SQL":e.bt("Using SQL", "Using SQL", "concierge.components.chat.sql.steps.text", undefined, true),"Executing the query":e.bt("Executing the query", "Executing the query", "concierge.components.chat.executing.steps.text", undefined, true),"The query execution is finished":e.bt("The query execution is finished", "The query execution is finished", "concierge.components.chat.query.finished.steps.text", undefined, true),Error:e.bt("Error", "Error", "concierge.components.chat.error.steps.text", undefined, true)}),g=["helix-users","helix-dev"],f="#pinnacle-feedback",v="https://pinterest.enterprise.slack.com/archives/C08K7TVLWJC",w="https://i.pinimg.com/originals/32/78/fb/3278fb42c068009b300151775abf22cd.png",y="https://i.pinimg.com/originals/0e/73/84/0e738478d913ac3c7d699e74918e3d9a.png",P="https://i.pinimg.com/originals/56/36/d3/5636d36bfe20b378b6a946ffc2b8dcee.png",x="https://i.pinimg.com/originals/7a/c0/dd/7ac0ddee9dcf249927b5e6a9d9363418.png",b={CUSTOMIZED_COMPONENT_BASE64_IMAGE:"customized_component_base64_image"}},903760:function(e,t,r){r.d(t,{D:()=>l,q:()=>u});var i=r(281098),a=r(667294),n=r(825332),s=r(378888),o=r(785893);let c=(0,a.createContext)(!1);function l({children:e}){(0,a.useEffect)(()=>{(0,i.Z)("InAppFactoryOAuthContext","/app/packages/InAppFactoryOAuthContext.tsx")},[]);let t=(()=>{let e=(0,n.TH)();return e.state?.isAppFactoryOAuth||((0,s.mB)(e.search).next??"").startsWith("/app-factory-oauth/")})(),[r,l]=(0,a.useState)(t);return(0,a.useEffect)(()=>{t&&l(!0)},[t]),(0,o.jsx)(c,{value:r,children:e})}function u(){return(0,a.useContext)(c)}},671003:function(e,t,r){r.d(t,{Z:()=>G});var i=r(281098),a=r(667294),n=r(825332),s=r(78730),o=r(346955),c=r(20256),l=r(667835),u=r(15667),d=r(647709),p=r(785893);function h({children:e}){(0,a.useEffect)(()=>{(0,i.Z)("GestaltColorSchemeProvider","/app/packages/gestaltExtensions/GestaltColorSchemeProvider.tsx")},[]);let t=(0,l.vs)(),r=(0,d.HG)(),{locale:n}=(0,u.B)();return(0,p.jsx)(c.Ag,{colorScheme:t&&!r?"dark":"light",children:(0,p.jsx)(c.Ho,{languageMode:{"ar-SA":"tall","bn-IN":"tall","hi-IN":"tall","te-IN":"tall","ko-KR":"ck","zh-CN":"ck","zh-TW":"ck",ja:"ja","th-TH":"th","vi-VN":"vi"}[n]??"default",children:e})})}function _({children:e}){(0,a.useEffect)(()=>{(0,i.Z)("GestaltDeviceTypeProvider","/app/packages/gestaltExtensions/GestaltDeviceTypeProvider.tsx")},[]);let t=(0,d.ml)();return(0,p.jsx)(c.Q_,{deviceType:t?"mobile":"desktop",children:e})}let m=[];function g({children:e}){(0,a.useEffect)(()=>{(0,i.Z)("GestaltExperimentProvider","/app/packages/gestaltExtensions/GestaltExperimentProvider.tsx")},[]);let t=(0,u.B)();(0,a.useMemo)(()=>({web_gestalt_calico:{anyEnabled:!0,group:"enabled"}}),[]);let r=m.reduce((e,r)=>({...e,[r]:t.experimentsClient.checkExperiment(r)}),{});return(0,p.jsx)(c.II,{value:r,children:e})}var f=r(816358),v=r(611282),w=r(104659);function y({children:e}){(0,a.useEffect)(()=>{(0,i.Z)("GestaltGlobalEventsHandlerProvider","/app/packages/gestaltExtensions/GestaltGlobalEventsHandlerProvider.tsx")},[]);let{sheetMobileHandlers:t,linkHandlers:r}=function(){let{setAppFocusState:e}=(0,w.G)(),t=(0,a.useCallback)(()=>{f.Z.pause(),e(!1)},[e]),r=(0,a.useCallback)(()=>{f.Z.resume(),e(!0)},[e]),i=(0,a.useMemo)(()=>({onOpen:t,onClose:r}),[t,r]);return{linkHandlers:(0,a.useMemo)(()=>({onNavigation:({href:e,target:t})=>(0,v.Z)({href:e,target:t})}),[]),sheetMobileHandlers:i}}();return(0,p.jsx)(c.uu,{linkHandlers:r,sheetMobileHandlers:t,children:e})}var P=r(390843),x=r(35814),b=r(903760),E=r(675973),T=r(368177),k=r(901360),I=r(529547),D=r(622481),C=r(282803),N=r(392824),A=r(735201),S=r(524447),Z=r(293169),j=r(430635);let L=e=>["/advertiser/"].reduce((t,r)=>e.includes(r)||t,!1);function B({children:e,immutableLocation:t,routerHistoryAction:r,staticContext:n}){(0,a.useEffect)(()=>{(0,i.Z)("PwtContext","/app/packages/pwt-logger/PwtContext.tsx")},[]);let s=(0,a.useRef)(null),o=(0,a.useRef)(null),c=(0,a.useRef)(t),l=(0,a.useRef)(!0),{path:u,params:d}=(0,j.Z)(),h=(0,a.useRef)(u),_=(0,a.useRef)(d),m=(0,I.Z)(n.deviceType);if(l.current&&(0,A.ZP)(!0,n.serverData?.trace_id),(0,a.useEffect)(()=>{h.current=u},[u]),(0,a.useEffect)(()=>{_.current=d},[d]),(0,a.useEffect)(()=>{(0,S.UQ)(),l.current=!1},[]),L(t.pathname)?c.current.pathname!==t.pathname:c.current!==t){c.current=t,o.current=window.performance?.now?window.performance.now():null;let{current:e}=o;if(!l.current){let t=!s.current;(0,k.A9)("routeStart",{tags:{action:r}}),(0,Z.Eg)(t),(0,S.Ux)(t),(0,S.on)(),(0,N.tl)(),(0,A._T)(),(0,A.ZP)(!1);let{defaultBufferSize:i}=(0,Z.LH)();e&&((0,k.A9)("routeStart.defaultBufferSize",{count:i}),s.current={time:e,action:r})}}return(0,p.jsx)(C.Z,{value:m?n:null,children:(0,p.jsx)(D.Z,{value:s.current,children:e})})}var O=r(939672),z=r(30880),F=r(754545),M=r(956077),R=r(603316);function q({children:e,immutableLocation:t,routerHistoryAction:r}){let i=(0,a.useRef)(!0),n=(0,a.useRef)(!1),s=(0,a.useRef)(!1),o=(0,a.useRef)(t),c=performance.now(),{group:l}=(0,E.Z)().checkExperiment("web_pwt_validate_suspense");return l&&(0,R.nP)("pwt_logger_v4_render",{sampleRate:1,tags:{experimentGroup:l}}),n.current=n.current||L(t.pathname)?o.current.pathname!==t.pathname:o.current!==t,n.current&&!s.current&&((0,F.yh)("routeChange"),s.current=!0,(0,O.N0)(),l&&(0,R.nP)("pwt_logger_v4_route_change_reset",{sampleRate:1,tags:{experimentGroup:l}})),(0,a.useLayoutEffect)(()=>{if((L(t.pathname)?o.current.pathname!==t.pathname:o.current!==t)||i.current){o.current=t;let e=i.current?0:c;(0,F.ep)(r,e,i.current),(0,M.Nx)("NavigationCompletev4"),i.current=!1,n.current=!1,s.current=!1,l&&(0,R.nP)("pwt_logger_v4_navigation_complete",{sampleRate:1,tags:{experimentGroup:l}})}},[i,r,t,c,n]),e}function U({children:e,immutableLocation:t,routerHistoryAction:r}){return((0,a.useEffect)(()=>{(0,i.Z)("PerformanceLoggingRoutingContext","/app/packages/pwt-logger/v4/PerformanceLoggingRoutingContext.tsx")},[]),(0,z.Z)())?(0,p.jsx)(O.mW,{children:(0,p.jsx)(q,{immutableLocation:t,routerHistoryAction:r,children:e})}):e}var H=r(791948);function V({children:e,traceLoggerData:t}){let r=(0,u.B)(),i=(0,n.ur)(),a=(0,n.TH)(),{group:s}=(0,E.Z)().checkExperiment("web_pwt_validate_suspense"),o=(0,T.Z)({requestContext:r,traceLoggerData:t});return(0,k.iF)(i),"enabled_switch_v4_v3"===s?(0,p.jsx)(U,{immutableLocation:a,routerHistoryAction:i,children:(0,p.jsx)(B,{immutableLocation:a,routerHistoryAction:i,staticContext:o,children:e})}):(0,p.jsx)(B,{immutableLocation:a,routerHistoryAction:i,staticContext:o,children:(0,p.jsx)(U,{immutableLocation:a,routerHistoryAction:i,children:e})})}function G({children:e,context:t,otaData:r,inContextTranslation:n,requestContext:c,resourceCreator:l,traceLoggerData:u}){(0,a.useEffect)(()=>{(0,i.Z)("WebappProvider","/app/packages/WebappProvider.tsx")},[]);let{anyEnabled:d}=(0,E.Z)().checkExperiment("web_pwt_validate_suspense"),m=(0,p.jsx)(_,{children:(0,p.jsx)(g,{children:(0,p.jsx)(h,{children:(0,p.jsx)(P.nK,{children:(0,p.jsx)(w.g,{children:(0,p.jsx)(y,{children:(0,p.jsx)(o.Ih,{children:(0,p.jsx)(b.D,{children:(0,p.jsx)(H.UZ,{resourceCreator:l,children:e})})})})})})})})});return(0,p.jsx)(s.E,{value:t,children:d?(0,p.jsx)(V,{traceLoggerData:u,children:(0,p.jsx)(x.Z,{enableInContextTranslation:n,locale:c.locale,otaData:r,children:m})}):(0,p.jsx)(x.Z,{enableInContextTranslation:n,locale:c.locale,otaData:r,children:(0,p.jsx)(V,{traceLoggerData:u,children:m})})})}},672431:function(e,t,r){r.d(t,{ES:()=>s,I3:()=>n,TY:()=>o,YX:()=>i,aD:()=>a});let i=1e4,a=300,n=[9,3],s={13:"VIEW",4703:"TIMED_PAIR_END",82:"PIN_SAVE_TO_DEVICE",8948:"PIN_CLICK"},o={9:"LOGIN",3:"PIN",186:"OFF_PINTEREST",11:"BROWSER"}},83896:function(e,t,r){let i,a;r.d(t,{li:()=>A,Ch:()=>T,nc:()=>S,a:()=>Z,ZP:()=>j,cA:()=>N});var n=r(172045),s=r(898582),o=r(575108),c=r(461093),l=r(296086),u=r(672431);function d(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:i+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let p="exponential";function h(e,t){let r=Math.max(e,0),i=Math.max(t,r);return Math.floor(r+Math.random()*(i-r+1))}class _{constructor(e={}){d(this,"strategy",p),d(this,"attempts",0),this.strategy=e.strategy??p}changeStrategy(e){this.strategy=e,this.attempts=0}next(){let e=function(e,t){if(e===p){let e=1e4*Math.pow(2,t);return h(Math.min(e,9e5),Math.min(Math.floor(1.5*e),9e5))}{let e=Math.max(6e5-6e4*t,0);return Math.max(Math.min(h(e,e*(1+.5*Math.pow(.6,t))),9e5),6e4)}}(this.strategy,this.attempts);return this.attempts+=1,e}}var m=r(973160),g=r(346955),f=r(810288),v=r(991384),w=r(2420),y=r(734215),P=r(664450),x=r(603316);let b=new Set([6945,170,3700]),E=new Set([3700]),T={3829:"articleImpressions",18:"pinImpressions",3700:"boardImpressions",3803:"searchImpressions",170:"storyImpression",3704:"userImpressions"},k=[4700,4701,4702,4703,7042,7043],I=e=>(0,f.Z)(JSON.stringify(e)),D=e=>b.has(e);function C(){let e=new Date;i?i&&i.getUTCDate()!==e.getUTCDate()&&(i=e,(0,l.Z)()):i=e}let N=e=>{let t=e.event_type,r=k.includes(t),i=(0,g.BE)();return!!r||13===t||!!i},A=(e,t)=>{let r=e.event_type,i=k.includes(r),a=(0,g.BE)();return i?e:13===r&&e.view_type?(t?.({viewType:e.view_type,viewParameter:e.view_parameter,viewData:a?.viewData?(0,v.Z)(a.viewData,e.view_data):e.view_data}),e):!a||e.view_type&&e.view_parameter?e:{...e,view_type:a.viewType||e.view_type,view_parameter:a.viewParameter,view_data:e.view_data?(0,v.Z)(e.view_data,a.viewData):a.viewData}},S=(e,t)=>{let{component:r,element:i}=e,a=e.object_id_str,n=e.view_type,s=e.event_type,{appState:o}=e;return(e.event_data?.[t]||[]).map(c=>{var l;let u;return{auxData:e.aux_data,...r?{component:r}:{},eventData:c,...s?{eventType:s}:{},...n?{viewType:n}:{},viewData:e.view_data,viewParameter:e.view_parameter,...a?{objectIdStr:a}:null,impressionType:t,...(l=e.event_data,u={},l?.storyPinProductEventData&&(u={...u,storyPinProductEventData:l.storyPinProductEventData}),u),appState:o,...i?{element:i}:{}}})??[]},Z=(e,t)=>({...e.component?{component:e.component}:{},...e.object_id_str?{objectIdStr:e.object_id_str}:null,...e.view_type?{viewType:e.view_type}:{},eventType:e.event_type,auxData:e.aux_data,impressionType:t,viewData:e.view_data,viewParameter:e.view_parameter,eventData:e.event_data});function j(e){let t=[],r=[],i=0,l=!1,d=!1;function h(){return[...t,...r.reduce((e,t)=>{let r=e.find(e=>e.view_type===t.viewType&&e.view_parameter===t.viewParameter&&e.event_type===t.eventType&&e.object_id_str===t.objectIdStr&&(0,y.Z)(e.view_data,t.viewData));if(r&&!D(t.eventType))t.impressionType in r.event_data?r.event_data[t.impressionType].push(t.eventData):r.event_data[t.impressionType]=[t.eventData];else{let r,i=t.storyPinProductEventData?{storyPinProductEventData:t.storyPinProductEventData}:{},a={appState:t.appState,aux_data:t.auxData||{},clientUUID:(0,n.Z)(),component:t.component,event_data:{...i,[t.impressionType]:!D(r=t.eventType)||D(r)&&E.has(r)?[t.eventData]:{...t.eventData,...(t.eventData||{})[t.impressionType]}},event_type:t.eventType,object_id_str:t.objectIdStr||void 0,time:(0,m.ZP)(),view_data:t.viewData,view_parameter:t.viewParameter,view_type:t.viewType,element:t.element};e.push(a)}return e},[])]}function g({error:e,isError:t,isDroppedEvent:r,isImpression:i,isEventSkipped:a}){let n,o=(0,s.Z)(),c=o?.userAgent||{},l=!(c.isMobile||c.isTablet),u={error_message:e?.message??"unknown",appType:l?"WEB_DENZEL":"WEB_MOBILE",country:o?.country??"unknown",browserName:c.browserName,osName:c.osName,browserType:c.browserType,browserVersion:c.browserVersion,isError:t,isImpression:i,isEventSkipped:a};n=r?"dropped":t?"errors":a?"skipped":"success",(0,x.nP)(`webapp.metrics.contextLog.indexdb.${n}`,{tags:u})}async function f(){try{await a?.clear()}catch(e){g({isError:!0,error:{message:"Error while clearing cache",details:e instanceof Error?e.message:"Unknown error",stack_trace:e instanceof Error?e.stack??"No stack trace available":"No stack trace available",errorName:e instanceof Error?e.name:"N/A"}})}}function v(){t=[],r=[],i=0}async function b(e){try{let t={...e,cache_created_time:(0,m.ZP)(),isImpression:!1,aux_data:{...e.aux_data,is_context_cached:!0}};await a?.setItem((0,n.Z)(),t)}catch(e){g({isError:!0,error:{message:"Transaction could not be added",details:e instanceof Error?e.message:"Unknown error",stack_trace:e instanceof Error?e.stack??"No stack trace available":"No stack trace available",errorName:e instanceof Error?e.name:"N/A"}})}}async function T(e){try{let t={...e,cache_created_time:(0,m.ZP)(),isImpression:!0,auxData:{...e.auxData,is_impression_cached:!0}};await a?.setItem((0,n.Z)(),t)}catch(e){g({isError:!0,isImpression:!0,error:{message:"Transaction could not be added",details:e instanceof Error?e.message:"Unknown error",stack_trace:e instanceof Error?e.stack??"No stack trace available":"No stack trace available",errorName:e instanceof Error?e.name:"N/A"}})}}async function k(){let t=h(),r=0,i=1e3,a=new _;if(!t.length)return;let n=(0,m.ZP)(),g=o.Z.create("ApiCResource",{events:t,report_time:n}),y=async()=>{try{n=(0,m.ZP)(),await g.callCreate({async:!0,showError:!1}),f()}catch(u){let e=(0,c.hw)(u),n=!e?.api_error_code||[w.dO,w.cZ,w.i1].includes(e.api_error_code),o=e?.api_error_code===w.QY||e?.httpStatus===400;if(!function({retryAttempts:e,error:t,events:r}){let i=(0,s.Z)(),a=i?.userAgent||{},n=!(a.isMobile||a.isTablet),o={...t,retryAttempts:e,appType:n?"WEB_DENZEL":"WEB_MOBILE",country:i?.country??"unknown",browserName:a.browserName,eventSize:r.length,osName:a.osName,browserType:a.browserType,browserVersion:a.browserVersion};(0,x.nP)("metrics_quality_web_retry_error_log",{tags:o})}({retryAttempts:r,error:e,events:t}),l){if(o)return void f();n||e?.httpStatus&&e.httpStatus>=500?a.changeStrategy("coolDown"):a.changeStrategy(p);let t=a.next();r+=1,setTimeout(y,t)}else if(n&&r<5){let e=i;r+=1,i*=2,setTimeout(y,e)}else d||f()}};y();var P=n;if(e)for(let e of t)(0,m.Q9)(e)&&(0,x.LY)("webapp.contextLogger.fastFlushEvents.latency",(P-e.time||0)/1e6,{sampleRate:1,tags:{event_type:u.ES[e.event_type],view_type:e.view_type?u.TY[e.view_type]:"unknown",cached:(e.aux_data?.is_timed_pair_cached||e.aux_data?.is_context_cached)??"false"}});v(),C()}async function N(){let e=d?function(e){return(0,m.ZP)()-e<15e9}:function(e){return(0,m.ZP)()-e<6e10},i=d?function(e){return(0,m.ZP)()-e>6048e11}:function(e){return(0,m.ZP)()-e>864e11};try{(await a?.getAllItem()||[]).forEach(a=>{let{value:n}=a,{cache_created_time:s,isImpression:o,...c}=n;i(s)?g({isDroppedEvent:!0,isError:!1}):e(s)?g({isEventSkipped:!0}):o?(r.push(c),g({isImpression:!0,isError:!1})):(t.push(c),g({isError:!1}))})}catch(e){g({isError:!0,error:{message:"Error while syncing cached events",details:e instanceof Error?e.message:"Unknown error",stack_trace:e instanceof Error?e.stack??"No stack trace available":"No stack trace available",errorName:e instanceof Error?e.name:"N/A"}})}finally{d||(k(),f())}}return{flushContextEvents:k,getContextEvents:h,logContextEvent:function({object_id_str:e,...r}){let a=(0,m.ZP)(),s={aux_data:{},event_data:{},view_data:{},...r,time:a,clientUUID:(0,n.Z)(),...e?{object_id_str:e}:null},o=function(e){if(!e)return e;let{element:t,eventData:r,component:i,objectId:a,view:n,viewParameter:s,viewData:o,durationNs:c,pairId:l,clientTrackingParams:u,...d}=e;return d}(s.aux_data);s={...s,aux_data:o},i+I(s)>20480&&k(),t.push(s),i+=I(s),C(),b(s)},logImpression:function(e){i+I(e)>20480&&k(),r.push(e),i+=I(e),T(e)},resetEventsBuffer:v,syncCachedEndEvents:N,_getIndexDBInstance:function(){return a},_setDecreaseSkipCachedEventsExperimentState:function(e){d=e},initiateIndexDBCache:function(){window?.indexedDB&&(a=a||new P.Z(window.indexedDB,"ContextLoggingDB","ContextLoggingTable"))},_setRetryV2ExperimentState:function(e){l=e}}}},973160:function(e,t,r){r.d(t,{Q9:()=>n,ZP:()=>s,sR:()=>a});var i=r(672431);let a=()=>{let e,t;return"undefined"!==document.hidden?(e="hidden",t="visibilitychange"):"undefined"!==document.msHidden?(e="msHidden",t="msvisibilitychange"):"undefined"!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),{hidden:e,visibilityChange:t}},n=e=>{switch(e.event_type){case 13:return!!e.view_type&&i.I3.includes(e.view_type);case 4703:if(3===e.view_type&&85===e.component&&(e.duration_ns||0)>=1e10||186===e.view_type||11===e.view_type)return!0;return!1;case 82:case 8948:return!0;default:return!1}},s=()=>1e6*Date.now()},622481:function(e,t,r){r.d(t,{Z:()=>i});let i=(0,r(667294).createContext)(null)},282803:function(e,t,r){r.d(t,{Z:()=>i});let i=(0,r(667294).createContext)(null)},664450:function(e,t,r){r.d(t,{Z:()=>i});class i{constructor(e,t="myDatabase",r="myStore"){var i,a,n;i="cache",a=new Map,(i="symbol"==typeof(n=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"))?n:n+"")in this?Object.defineProperty(this,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):this[i]=a,this.dbName=t,this.storeName=r,this.dbPromise=(async()=>{try{return await this.initializeDB(e)}catch{return null}})()}async initializeDB(e){return new Promise((t,r)=>{try{let i=e.open(this.dbName,1);i.onerror=()=>{r(Error("IndexedDB initialization error: "+i.error))},i.onupgradeneeded=()=>{let e=i.result;e.objectStoreNames.contains(this.storeName)||e.createObjectStore(this.storeName,{keyPath:"key"})},i.onsuccess=()=>{t(i.result)}}catch(e){r(Error("IndexedDB initialization error: "+e))}})}async reopenDatabaseIfClosed(){let e=await this.dbPromise;return e&&!e.close?e:(this.dbPromise=this.initializeDB(window.indexedDB),this.dbPromise)}async getObjectStore(e="readwrite"){let t=await this.reopenDatabaseIfClosed();return t?t.transaction(this.storeName,e).objectStore(this.storeName):null}async getItem(e){if(this.cache.has(e))return this.cache.get(e)??null;let t=await this.getObjectStore();return t?new Promise((r,i)=>{let a=t.get(e);a.onerror=()=>i(a.error),a.onsuccess=()=>{let t=a.result?.value||null;null!==t&&this.cache.set(e,t),r(t)}}):null}async getAllItem(){let e=await this.getObjectStore();return e?new Promise((t,r)=>{let i=e.getAll();i.onerror=()=>r(i.error),i.onsuccess=()=>{i.result?.forEach(e=>{this.cache.set(e.key,e.value)}),t(i.result)}}):null}async setItem(e,t){this.cache.set(e,t);let r=await this.getObjectStore();return r?new Promise((i,a)=>{let n=r.put({key:e,value:t});n.onerror=()=>{a(n.error)},n.onsuccess=()=>{i(null)}}):null}async removeItem(e){this.cache.delete(e);let t=await this.getObjectStore();return t?new Promise((r,i)=>{let a=t.delete(e);a.onerror=()=>i(a.error),a.onsuccess=()=>r(null)}):null}async clear(){this.cache.clear();let e=await this.getObjectStore();return e?new Promise((t,r)=>{let i=e.clear();i.onerror=()=>r(i.error),i.onsuccess=()=>t(null)}):null}}},121793:function(e,t,r){let i;r.d(t,{w:()=>m});var a=r(898582),n=r(973160),s=r(664450),o=r(732888),c=r(510928),l=r(603316);function u(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:i+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let d=null,p="ACTIVE",h="PAUSED",_=()=>window&&window.performance&&window.performance.now?`(Time: ${(window.performance.now()/1e3).toFixed(3)}s)`:"";function m({contextLogger:e}){if(i||(i=window?.indexedDB?new s.Z(window.indexedDB,"EventLoggingDB","TimeSpent"):null),d)return d;let t=new Map,r=(0,c.Z)()&&(0,c.Z)().debug_timespent,m=[],g=r?console:{error:(...e)=>{},log:(...e)=>{},group:(...e)=>{},groupEnd:(...e)=>{}};return console.group||(g.group=(...e)=>console.log(...e),g.groupEnd=(...e)=>{}),d=new class{constructor(){u(this,"appTimedPair",null),u(this,"clickthroughProperties",null),u(this,"historyStackContext",null),u(this,"offsiteTimedPair",null),u(this,"offsiteTimedPairForegroundId",null),u(this,"pins",Object.freeze({})),u(this,"addEventListeners",()=>{var e;let t,{hidden:r,visibilityChange:i}=(0,n.sR)(),a=e=>{document[r]?this.unregisterApp(void 0,e):this.registerApp()};i&&document.addEventListener(i,a,!1),window.addEventListener("focus",this.registerApp),window.addEventListener("blur",e=>this.unregisterApp(void 0,e));let s=(e=e=>this.unregisterApp(void 0,e),t=!1,(...r)=>{t||(t=!0,e(...r))});window.addEventListener("beforeunload",s),window.addEventListener("pagehide",s);let o=navigator&&navigator.userAgent.toLowerCase();o&&o.includes("macintosh")&&o.includes("chrome")&&window.addEventListener("popstate",()=>{document.hasFocus()||document[r]||(0,l.nP)("chrome_mac_back_forward_button",{sampleRate:1})})}),u(this,"storeClickthroughProperties",e=>{this.clickthroughProperties&&(0,l.nP)("webapp.metrics.clickthroughs.overwritten",{sampleRate:1,tags:{previousView:this.clickthroughProperties.view_type,previousViewParameter:this.clickthroughProperties.view_parameter,nextView:e.view_type,nextViewParameter:e.view_parameter}}),this.clickthroughProperties={time:(0,n.ZP)(),...e}}),u(this,"clearClickthroughProperties",()=>{this.clickthroughProperties=null,this.offsiteTimedPair=null,this.offsiteTimedPairForegroundId=null}),u(this,"registerApp",()=>{g.group("App Foreground",_()),null==this.appTimedPair?(this.appTimedPair=new o.Z,this.appTimedPair.start(),this._unpauseAllComponents(),this._endOffsiteTimedPair(),null!==this.appTimedPair&&void 0!==this.appTimedPair&&e.logContextEvent({event_type:4700,pair_id:this.appTimedPair.uuid})):g.error("TimedPair already exists for app."),g.groupEnd()}),u(this,"logIndexDbStatLog",({error:e,isError:t,isDroppedEvent:r})=>{let i,n=(0,a.Z)(),s=n?.userAgent||{},o=!(s.isMobile||s.isTablet),c={error_message:e?.message??"unknown",appType:o?"WEB_DENZEL":"WEB_MOBILE",country:n?.country??"unknown",browserName:s.browserName,osName:s.osName,browserType:s.browserType,browserVersion:s.browserVersion,isError:t,errorName:e?.errorName??"unknown",errorDetails:e?.details??"unknown",errorStackTrace:e?.stack_trace??"unknown"};i=r?"dropped":t?"errors":"success",(0,l.nP)(`webapp.metrics.timespent.indexdb.${i}`,{tags:c})}),u(this,"unregisterApp",(t=!1,r)=>{g.group("App Background",_());let{appTimedPair:i}=this;if(null!=i){this._pauseAllComponents();let t=i.end();this._startOffsiteTimedPair(),e.logContextEvent({event_type:4701,duration_ns:t,pair_id:i.uuid}),this.appTimedPair=null}else g.error("No TimedPair found for app.");let a=["beforeunload","pagehide"],n=a.includes(r?.type||""),s=a.includes(r?.pauseReason||"");(n||s)&&this._endOffsiteTimedPair(),t||e.flushContextEvents(),g.groupEnd()}),u(this,"_activateComponent",t=>{g.group("Activating component",_()),r&&g.log(t.getContext());let i=t.getTimedPair();if(i){i.start();let{view:r,viewParameter:a,component:n,element:s,objectId:o,clientTrackingParams:c}=t.getLoggerContext();e.logContextEvent({event_type:4702,view_type:r,view_parameter:a,component:n,element:s,object_id_str:o,view_data:t.props.viewData,pair_id:i.uuid,clientTrackingParams:c,aux_data:{time_spent_foreground_pairid:this.appTimedPair&&this.appTimedPair.uuid,time_spent_parent_pairid:t.getParentId(),...t.props.auxData}})}g.groupEnd()}),u(this,"_deactivateComponent",t=>{g.group("Deactivating component",_()),r&&g.log(t.getContext());let i=t.getTimedPair();if(i){let{view:r,viewParameter:a,component:n,element:s,objectId:o,clientTrackingParams:c}=i,l=i.end();e.logContextEvent({event_type:4703,view_type:r,view_parameter:a,component:n,element:s,object_id_str:o,view_data:t.props.viewData,duration_ns:l,pair_id:i.uuid,clientTrackingParams:c,aux_data:{time_spent_foreground_pairid:this.appTimedPair&&this.appTimedPair.uuid,time_spent_parent_pairid:t.getParentId(),...t.props.auxData}})}g.groupEnd()}),u(this,"_startOffsiteTimedPair",()=>{this.clickthroughProperties&&(this.offsiteTimedPair=new o.Z({view:186,viewParameter:this.clickthroughProperties.view_parameter,objectId:this.clickthroughProperties.object_id_str}),this.offsiteTimedPair.start(),this.offsiteTimedPairForegroundId=this.appTimedPair?this.appTimedPair.uuid:null,this.clickthroughProperties={...this.clickthroughProperties,aux_data:{...this.clickthroughProperties.aux_data,time_to_offsite:void 0!==this.clickthroughProperties.time&&null!==this.clickthroughProperties.time&&"number"==typeof this.clickthroughProperties.time?(0,n.ZP)()-this.clickthroughProperties.time:void 0}},e.logContextEvent({...this.clickthroughProperties,event_type:4702,view_type:186,pair_id:this.offsiteTimedPair?this.offsiteTimedPair.uuid:null,aux_data:{...this.clickthroughProperties.aux_data,time_spent_foreground_pairid:this.offsiteTimedPairForegroundId}}),this._addOffSitePairToIndexDB({offsiteTimedPairUUID:this.offsiteTimedPair?.uuid,clickthroughProperties:this.clickthroughProperties,timeCreated:this.offsiteTimedPair?.startTime,offsiteTimedPairForegroundId:this.offsiteTimedPairForegroundId}))}),u(this,"_endOffsiteTimedPair",()=>{let{offsiteTimedPair:t,clickthroughProperties:r}=this;if(t&&r){let i=t.end();e.logContextEvent({...r,event_type:4703,view_type:186,pair_id:this.offsiteTimedPair?this.offsiteTimedPair.uuid:null,aux_data:{...r.aux_data,time_spent_foreground_pairid:this.offsiteTimedPairForegroundId},duration_ns:i}),this._removeOffSitePairByIdFromIndexDB(this.offsiteTimedPair?.uuid),this._syncCachedTimedPairEndEvents(),this._onOffsiteEnd(),this.clearClickthroughProperties()}else this._syncCachedTimedPairEndEvents()}),u(this,"_addOffSitePairToIndexDB",async({offsiteTimedPairUUID:e,clickthroughProperties:t,timeCreated:r,offsiteTimedPairForegroundId:a})=>{try{await i?.setItem(e,{clickthroughProperties:{...t},timeCreated:r,offsiteTimedPairForegroundId:a})}catch(e){this.logIndexDbStatLog({isError:!0,error:{message:"Transaction could not be added",details:e instanceof Error?e.message:"Unknown error",stack_trace:e instanceof Error?e.stack??"No stack trace available":"No stack trace available",errorName:e instanceof Error?e.name:"N/A"}})}}),u(this,"_addAppTimerToIndexDB",async({foregroundAppTimerUUID:e,timeCreated:t})=>{try{await i?.setItem(e,{timeCreated:t})}catch(e){this.logIndexDbStatLog({isError:!0,error:{message:"Transaction could not be added",details:e instanceof Error?e.message:"Unknown error",stack_trace:e instanceof Error?e.stack??"No stack trace available":"No stack trace available",errorName:e instanceof Error?e.name:"N/A"}})}}),u(this,"_removeAppTimerFromIndexDB",async({foregroundAppTimerUUID:e})=>{try{if(!e)return;await i?.removeItem(e)}catch(e){this.logIndexDbStatLog({isError:!0,error:{message:"Transaction could not be removed",details:e instanceof Error?e.message:"Unknown error",stack_trace:e instanceof Error?e.stack??"No stack trace available":"No stack trace available",errorName:e instanceof Error?e.name:"N/A"}})}}),u(this,"_removeOffSitePairByIdFromIndexDB",async e=>{try{if(!e)return;await i?.removeItem(e)}catch(e){this.logIndexDbStatLog({isError:!0,error:{message:"Transaction could not be removed",details:e instanceof Error?e.message:"Unknown error",stack_trace:e instanceof Error?e.stack??"No stack trace available":"No stack trace available",errorName:e instanceof Error?e.name:"N/A"}})}}),u(this,"_syncCachedTimedPairEndEvents",async()=>{try{(await i?.getAllItem()||[]).forEach(async t=>{let{key:r,value:i}=t,{clickthroughProperties:a,timeCreated:n,offsiteTimedPairForegroundId:s}=i,c=(0,o.h)();n&&(0,o.h)()-n>864e11?this.logIndexDbStatLog({isDroppedEvent:!0,isError:!1}):(e.logContextEvent({...a,event_type:4703,view_type:186,pair_id:r||null,aux_data:{...a?.aux_data,time_spent_foreground_pairid:s,is_timed_pair_cached:!0},duration_ns:n?c-n:null}),this.logIndexDbStatLog({isError:!1}))}),await i?.clear()}catch(e){this.logIndexDbStatLog({isError:!0,error:{message:"Error while syncing cached events",details:e instanceof Error?e.message:"Unknown error",stack_trace:e instanceof Error?e.stack??"No stack trace available":"No stack trace available",errorName:e instanceof Error?e.name:"N/A"}})}}),u(this,"_onOffsiteEnd",()=>{g.group("Trigger onOffsiteEndCallbacks"),m.forEach(e=>e({appTimedPair:this.appTimedPair,clickthroughProperties:this.clickthroughProperties,offsiteTimedPair:this.offsiteTimedPair,offsiteTimedPairForegroundId:this.offsiteTimedPairForegroundId})),g.groupEnd()}),u(this,"_pauseAllComponents",()=>{g.group("Pause all components"),t.forEach((e,t,r)=>{e===p&&this._deactivateComponent(t),r.set(t,h)}),g.groupEnd()}),u(this,"_unpauseAllComponents",()=>{g.group("Unpause all components"),t.forEach((e,r)=>{let i=new o.Z(r.getLoggerContext());r.setTimedPair(i,()=>{t.set(r,p),this._activateComponent(r)})}),g.groupEnd()})}setHistoryStackContext(e){this.historyStackContext=e}setPins(e){this.pins=e}startOffsiteRightClickTimedPair(t=!1){this._startOffsiteTimedPair(),t||e.flushContextEvents()}registerComponent(e){null===this.appTimedPair?t.set(e,h):(t.set(e,p),this._activateComponent(e))}unregisterComponent(e){t.get(e)===p&&(this._deactivateComponent(e),e.setTimedPair(new o.Z(e.getLoggerContext()))),t.delete(e)}size(){return t.size}onOffsiteEnd(e){m.push(e)}removeOnOffsiteEnd(e){let t=m.indexOf(e);t>-1&&m.splice(t,1)}_getIndexDBInstance(){return i}_getContextLogger(){return e}_clearTimeSpentManager(){this.appTimedPair=null,this.offsiteTimedPairForegroundId=null,d=null}_clearIndexDB(){i?.clear(),i=null}}}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/65259.en_GB-ff6b0c2ad12dc4b0.mjs.map